{% load staticfiles %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>Veterinaria Sevilla</title>

    <!-- Bootstrap core CSS -->
    <link href="{% static "dist/css/bootstrap.min.css" %}" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="{% static "css/dashboard.css" %}" rel="stylesheet">
    <link href="{% static "dist/css/jquery.dataTables.min.css" %}" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    {% include navbar %}
    
    <div id="contenido_principal" class="container-fluid">
      <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
          <ul class="nav nav-sidebar">
            <li><a href="/caja">Caja</a></li>
            <li class="active"><a href="/clientes">Clientes<span class="sr-only">(current)</span></a></li>
            <li><a href="/mascotas">Mascotas</a></li>
          </ul>
          <ul class="nav nav-sidebar">
            <li><a href="">Atención Clínica</a></li>
            <li><a href="">Hospital</a></li>
            <li><a href="">Peluquería</a></li>
            <li><a href="">Hotel</a></li>
          </ul>
          <ul class="nav nav-sidebar">
            <li><a href="">Inventario</a></li>
            <li><a href="">Calendario</a></li>
            <li><a href="">Horario</a></li>
            <li><a href="">Finanzas</a></li>
          </ul>
        </div>
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
          <div style="display: inline-flex; align-items:flex-end">
            <img src="{% static "dist/fonts/blue_paw_add.png"%}" class="img-responsive center-block" style="height:60px;">
            <h2 class="page-header" style="display: inline-table; margin-bottom:0px">&nbsp;Ingresar Nueva Mascota de {{ cliente }}</h2>
          </div>
          <div class="row ">
          <br/>
          </div>
            <form action="/clientes/nueva_mascota?id={{ cliente.id }}" method="post">
              {% csrf_token %}
              <div class="panel panel-primary">
                <div class="panel-heading" style="font-size: 18px;">Datos de la Mascota</div>
                <div class="panel-body">
                  {{ mascotas_form.management_form }}
                  {% for mascota_form in mascotas_form %}
                    <div class="item">
                      <div class="col-sm-12">
                        <label class="col-sm-2 control-label">Nombre:</label>
                        <div>
                          {{ mascota_form.nombre }}
                        </div>
                      </div>
                      <div class="col-sm-12">
                        <label class="col-sm-2 control-label">Fecha de Nacimiento:</label>
                        <div>
                          {{ mascota_form.fecha_nacimiento }}
                        </div>
                      </div>
                      <div class="col-sm-12">
                        <label class="col-sm-2 control-label">Especie:</label>
                        <div>
                          {{ mascota_form.especie }}
                        </div>
                      </div>
                      <div class="col-sm-12">
                        <label class="col-sm-2 control-label">Raza:</label>
                        <div>
                          {{ mascota_form.raza }}
                        </div>
                      </div>
                      <div class="col-sm-12">
                        <label class="col-sm-2 control-label">Color:</label>
                        <div>
                          {{ mascota_form.color }}
                        </div>
                      </div>
                      <div class="col-sm-12">
                        <label  class="col-sm-2 control-label">Sexo:</label>
                        <div>
                          {{ mascota_form.sexo }}
                        </div>
                      </div>
                      <div class="col-sm-12">
                        <label class="col-sm-2 control-label">Suscrito:</label>
                        <div>
                          {{ mascota_form.suscrito }}
                        </div>
                      </div>
                      <div align="right"><a href="#"  class="delete" style="display:none">Borrar</a></div>
                      <hr class="hrfinal" style="display:none; height:0.8px;border:none;color:rgb(76, 139, 192);background-color:rgb(76, 139, 192);"/>
                    </div>
                  {% endfor %}
                </div>
                <div class="panel-footer">
                  <a href="#" style="display:inline-table" id="add_mascota" ><img src="{% static "dist/fonts/Blue_paw_add.png"%}" class="img-responsive center-block" style="height:35px" title="Añadir otra Mascota"> Añadir otra Mascota</a>
                </div>  
              </div>
              <div class="col-sm-3 col-sm-offset-9 col-md-3 col-md-offset-9">
                <button type="submit" class="btn btn-success btn-lg">Ingresar Datos</button>
              </div>
            </form>
        </div>
      </div>
    </div>
  </body>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="{% static "dist/js/jquery-1.11.3.min.js" %}"></script>
    <script src="{% static "dist/js/bootstrap.min.js" %}"></script>
      <!-- script para multi-form de mascotas -->
  <script type="text/javascript">
      $(document).ready(function () {
          //$( ".datepicker" ).datepicker();
          // Code adapted from http://djangosnippets.org/snippets/1389/
          function updateElementIndex(el, prefix, ndx) {
              var id_regex = new RegExp('(' + prefix + '-\\d+-)');
              var replacement = prefix + '-' + ndx + '-';
              if ($(el).attr("for")) $(el).attr("for", $(el).attr("for").replace(id_regex, replacement));
              if (el.id) el.id = el.id.replace(id_regex, replacement);
              if (el.name) el.name = el.name.replace(id_regex, replacement);
          }

          function deleteForm(btn, prefix) {
              var formCount = parseInt($('#id_' + prefix + '-TOTAL_FORMS').val());

              if (formCount > 1) {
                  if(formCount==2){
                    $('.delete').hide();
                  }
                  // Delete the item/form
                  $(btn).parents('.item').remove();
                  var forms = $('.item'); // Get all the forms
                  // Update the total number of forms (1 less than before)
                  $('#id_' + prefix + '-TOTAL_FORMS').val(forms.length);

                  var i = 0;
                  // Go through the forms and set their indices, names and IDs
                  for (formCount = forms.length; i < formCount; i++) {
                      $(forms.get(i)).children().children().each(function () {
                          updateElementIndex(this, prefix, i);
                      });
                  }
                  $('.hrfinal:last').hide();
              }
              else {
                  alert("Debes agregar al menos una mascota!");
              }
              return false;
          }

          function addForm(btn, prefix) {
              var formCount = parseInt($('#id_' + prefix + '-TOTAL_FORMS').val());
              $('.hrfinal').show();
              // You can only submit a maximum of 20 forms
              if (formCount < 20) {
                  // Clone a form (without event handlers) from the first form
                  var row = $(".item:first").clone(false).get(0);

                  // Insert it after the last form
                  $(row).removeAttr('id').hide().insertAfter(".item:last").slideDown(300);

                  // Remove the bits we don't want in the new row/form
                  // e.g. error messages
                  $(".errorlist", row).remove();
                  $(row).children().removeClass('error');
                  // Relabel/rename all the relevant bits
                  $(row).children().children().children().each(function () {
                      updateElementIndex(this, prefix, formCount);
                      if ($(this).attr('type') == 'text')
                          $(this).val('');
                  });
                  $(row).children().children().each(function () {
                      updateElementIndex(this, prefix, formCount);
                      if ($(this).attr('type') == 'text')
                          $(this).val('');
                  });
                  // Add an event handler for the delete item/form link
                  $(row).find('.delete').click(function () {
                      return deleteForm(this, prefix);
                  });
                  
                  // Update the total form count;
                  $('#id_' + prefix + '-TOTAL_FORMS').val(formCount + 1);
                  //$(".datepicker").datepicker();
                  $(".delete").show();
                  $('.hrfinal:last').hide();

              } // End if
              else {
                  alert("Lo siento, no más de 20 mascotas.");
              }
              return false;
          }

          // Register the click event handlers
          $("#add_mascota").click(function () {
              return addForm(this, 'mascotas');
          });

          $(".delete").click(function () {
              return deleteForm(this, 'mascotas');
          });
      });
  </script>
</html>
